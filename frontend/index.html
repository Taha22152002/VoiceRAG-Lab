<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurable RAG Chatbot Builder - Multi-Mode Ingestion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Existing custom styles remain unchanged */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #384959; 
            color: #BDDDFC; 
        }
        .card {
            background-color: #304151; 
            border: 1px solid #4A637C; 
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5); 
        }
        input, textarea {
            background-color: #384959;
            color: #BDDDFC; 
            border-color: #4A637C; 
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #88BBF2;
            box-shadow: 0 0 0 1px #88BBF2, 0 0 8px rgba(136, 187, 242, 0.4); 
        }
        .slate-btn {
            background-color: #6A89A7; 
            color: #384959; 
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(106, 137, 167, 0.5); 
            transition: all 0.2s; 
        }
        .slate-btn:hover {
            background-color: #88BBF2; 
            color: #384959;
            box-shadow: 0 4px 15px rgba(136, 187, 242, 0.7); 
        }
        .slate-btn:disabled {
            background-color: #4A637C; 
            color: #BDDDFC;
            box-shadow: none;
        }
        .clear-chat-btn {
            background-color: #4A637C; 
            color: #BDDDFC;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.2s;
        }
        .clear-chat-btn:hover {
            background-color: #59738A; 
            box-shadow: 0 0 10px rgba(74, 99, 124, 0.7);
        }
        .status-success {
            background-color: #2D583F; 
            border-color: #457A59;
            color: #A3D9B5; 
        }
        .status-error {
            background-color: #BDDDFC; 
            border-color: #6A89A7; 
            color: #384959; 
            font-weight: 700; 
        }
        .status-loading {
            background-color: #304151;
            border-color: #88BBF2;
            color: #88BBF2;
            font-weight: 700;
        }
        .user-bubble {
            background-color: #6A89A7; 
            color: #384959; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }
        .bot-bubble {
            background-color: #BDDDFC; 
            color: #384959; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-weight: 500;
        }
        .system-bubble {
            background-color: #304151; 
            color: #BDDDFC; 
            border: 1px solid #4A637C;
        }
        .system-bubble .label {
            color: #88BBF2; 
        }
        .file-upload-highlight .file {
            background-color: #6A89A7; 
            color: #384959;
        }
        .file-upload-highlight .file:hover {
             background-color: #88BBF2; 
        }
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        .chat-container::-webkit-scrollbar-track {
            background: #304151; 
        }
        .chat-container::-webkit-scrollbar-thumb {
            background-color: #6A89A7; 
            border-radius: 4px;
            border: 2px solid #304151;
        }
        .bot-bubble ul {
            list-style: disc;
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            padding-left: 0.5rem;
        }
        .bot-bubble li {
            margin-bottom: 0.25rem;
        }
        
        /* Modal Styles */
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        .modal-content {
            background-color: #304151;
            border: 1px solid #4A637C;
        }
        .modal-table {
            border-collapse: separate;
            border-spacing: 0 8px; /* Vertical spacing between rows */
        }
        .modal-table td {
            padding: 8px;
            background-color: #384959;
            border-radius: 6px;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-7xl mx-auto card rounded-xl p-4 md:p-8">
        <h2 class="text-3xl font-bold text-[#88BBF2] mb-2">ü§ñ Configurable RAG Chatbot Builder</h2>
        <p class="text-[#BDDDFC] mb-6">Dynamically configure your chatbot using a system prompt, and choose one of three knowledge base ingestion methods.</p>

        <div class="flex flex-col md:flex-row gap-6">

            <div class="md:w-1/3 flex flex-col space-y-4">
                
                <div class="card rounded-lg p-4">
                    <label for="system-prompt" class="block text-sm font-medium text-[#BDDDFC] mb-1">üß≠ System Prompt</label>
                    <textarea id="system-prompt" rows="6" class="w-full p-3 rounded-lg focus:ring-[#6A89A7] focus:border-[#6A89A7] placeholder-[#888] text-sm"
                        placeholder="Define chatbot behavior, e.g., 'Act as a friendly financial advisor.'">
Act as a helpful and concise assistant. ONLY use the provided context from the knowledge base to answer questions. If the answer is not in the context, clearly state that the information is unavailable in the documents.
                    </textarea>
                </div>

                <div class="card rounded-lg p-4">
                    <label class="block text-sm font-medium text-[#BDDDFC] mb-2">üìö Knowledge Base Ingestion Mode</label>
                    
                    <div class="flex space-x-2 mb-4 text-sm font-semibold">
                        <label class="flex items-center space-x-1 cursor-pointer">
                            <input type="radio" name="ingestion-mode" value="files" checked onchange="changeIngestionMode('files')" class="form-radio text-[#88BBF2]">
                            <span class="text-[#BDDDFC]">1. Files</span>
                        </label>
                        <label class="flex items-center space-x-1 cursor-pointer">
                            <input type="radio" name="ingestion-mode" value="text" onchange="changeIngestionMode('text')" class="form-radio text-[#88BBF2]">
                            <span class="text-[#BDDDFC]">2. Text</span>
                        </label>
                        <label class="flex items-center space-x-1 cursor-pointer">
                            <input type="radio" name="ingestion-mode" value="links" onchange="changeIngestionMode('links')" class="form-radio text-[#88BBF2]">
                            <span class="text-[#BDDDFC]">3. Links</span>
                        </label>
                    </div>

                    <div id="ingest-mode-files" class="border border-dashed border-[#4A637C] bg-[#384959] p-4 rounded-lg file-upload-highlight">
                        <label for="file-upload" class="block text-sm font-medium text-[#BDDDFC] mb-1">Upload Documents</label>
                        <input type="file" id="file-upload" multiple 
                            accept=".pdf, .docx, .doc, .txt, .csv, .json, .xlsx, .xls" 
                            class="w-full text-sm text-[#BDDDFC] file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:slate-btn"
                            onchange="validateInputs()">
                        <span id="file-count" class="text-xs text-[#88BBF2] mt-1 block">0 files selected (Supports PDF, DOCX/DOC, TXT, JSON, CSV, and XLS/XLSX)</span> 
                    </div>

                    <div id="ingest-mode-text" class="hidden">
                        <button onclick="openTextModal()" class="w-full py-2 slate-btn rounded-lg">Add Text Entries</button>
                        <span id="text-entry-count" class="text-xs text-[#88BBF2] mt-2 block text-center">0 text entries added.</span>
                    </div>

                    <div id="ingest-mode-links" class="hidden">
                        <button onclick="openLinkModal()" class="w-full py-2 slate-btn rounded-lg">Add Web Links</button>
                        <span id="link-entry-count" class="text-xs text-[#88BBF2] mt-2 block text-center">0 link entries added.</span>
                    </div>

                </div>
                <div class="card rounded-lg p-4">
                    <label for="api-endpoint" class="block text-sm font-medium text-[#BDDDFC] mb-1">üîó LLM API Endpoint (Backend Server)</label>
                    <input type="text" id="api-endpoint" disabled class="w-full p-2 rounded-lg focus:ring-[#6A89A7] focus:border-[#6A89A7] placeholder-[#888] text-sm"
                        placeholder="Using RAG Backend at http://127.0.0.1:5000">
                </div>

                <div>
                    <label for="status-box" class="block text-sm font-medium text-[#BDDDFC] mb-1">System Status</label>
                    <div id="status-box" class="w-full p-3 rounded-lg text-sm status-error font-semibold"
                        data-initial-value="‚ö†Ô∏è Waiting for input...">
                        ‚ö†Ô∏è Waiting for input...
                    </div>
                </div>

                <button id="start-btn" onclick="startChat()" disabled
                    class="w-full py-3 px-4 slate-btn font-semibold rounded-lg transition duration-300 disabled:bg-[#4A637C]">
                    üöÄ Start Chat (Process Knowledge Base)
                </button>
            </div>

            <div class="md:w-2/3 flex flex-col space-y-4 h-[600px]"> <div class="flex-grow flex flex-col card rounded-lg shadow-inner p-4 min-h-0"> <label class="text-sm font-medium text-[#BDDDFC] mb-2">üí¨ Chat Window</label>
                    <div id="chatbot" class="chat-container flex-grow overflow-y-auto space-y-4 p-2 h-auto"> <div class="flex justify-start">
                            <div class="system-bubble p-3 rounded-xl rounded-tl-sm max-w-xs md:max-w-md shadow-sm">
                                <span class="font-bold text-xs label">Bot</span><br>
                                Hello! Configure my settings and choose an ingestion mode (Files, Text, or Links) to begin our conversation.
                            </div>
                        </div>
                    </div>
                </div>
                <div id="recording-indicator" class="hidden text-center py-2 text-[#88BBF2] font-semibold">
                    üé§ Recording... Speak now
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="user-message" class="flex-grow p-3 rounded-lg focus:ring-[#6A89A7] focus:border-[#6A89A7] placeholder-[#888] text-sm"
                        placeholder="Type a message and press Enter..." onkeydown="if(event.key === 'Enter') sendMessage()">
                    <button id="voice-btn" onclick="toggleVoiceRecording()" 
                            class="py-3 px-4 bg-[#6A89A7] hover:bg-[#88BBF2] text-[#384959] font-semibold rounded-lg shadow-md transition duration-300 disabled:opacity-60 disabled:cursor-not-allowed"
                            title="Click and hold to record voice message">
                        üé§
                    </button>
                    <button id="mute-btn" onclick="toggleMute()"
                            class="py-3 px-4 bg-[#4A637C] hover:bg-[#59738A] text-[#BDDDFC] font-semibold rounded-lg shadow-md transition duration-300 sm:w-auto w-full"
                            title="Toggle microphone mute">
                        üîá
                    </button>
                    <button onclick="sendMessage()" id="send-btn" disabled
                        class="py-3 px-4 slate-btn font-semibold rounded-lg shadow-md transition duration-300 disabled:opacity-60 disabled:cursor-not-allowed disabled:bg-[#4A637C] sm:w-auto w-full">
                        Send
                    </button>
                </div>

                <button id="clear-btn" onclick="clearChat()"
                    class="w-full py-2 px-4 clear-chat-btn font-semibold rounded-lg focus:outline-none focus:ring-4 focus:ring-[#6A89A7]">
                    Clear Chat
                </button>
            </div>
        </div>
    </div>

    <div id="text-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content rounded-xl p-6 w-full max-w-2xl">
            <h3 class="text-xl font-bold mb-4 text-[#88BBF2]">üìù Add Text Entries</h3>
            
            <div class="flex space-x-2 mb-4">
                <input type="text" id="text-name-input" placeholder="Name/Source (e.g., Policy 1)" class="p-2 rounded-lg text-sm w-1/3">
                <textarea id="text-value-input" rows="3" placeholder="Value (The actual text content)" class="p-2 rounded-lg text-sm flex-grow"></textarea>
                <button onclick="addTextEntry()" class="py-2 px-4 slate-btn font-semibold rounded-lg text-sm whitespace-nowrap">Add Text</button>
            </div>
            
            <p id="text-modal-error" class="text-sm text-red-400 mb-2"></p>

            <div class="max-h-60 overflow-y-auto card rounded-lg p-2">
                <table id="text-entry-table" class="modal-table w-full text-left text-sm">
                    <thead>
                        <tr class="text-[#88BBF2]">
                            <th class="p-2 w-1/4">Name</th>
                            <th class="p-2 w-3/4">Value (Snippet)</th>
                            <th class="p-2 w-16"></th>
                        </tr>
                    </thead>
                    <tbody id="text-entry-list">
                        </tbody>
                </table>
                <p id="no-text-entries" class="text-center text-[#6A89A7] py-4">No text entries added yet.</p>
            </div>

            <div class="flex justify-end mt-4">
                <button onclick="closeTextModal()" class="py-2 px-4 clear-chat-btn font-semibold rounded-lg">Done</button>
            </div>
        </div>
    </div>

    <div id="link-modal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden">
        <div class="modal-content rounded-xl p-6 w-full max-w-2xl">
            <h3 class="text-xl font-bold mb-4 text-[#88BBF2]">üîó Add Web Links</h3>
            
            <div class="flex space-x-2 mb-4">
                <input type="text" id="link-name-input" placeholder="Name (e.g., Docs Page)" class="p-2 rounded-lg text-sm w-1/3">
                <input type="url" id="link-value-input" placeholder="Link (Must be a full URL, e.g., https://...)" class="p-2 rounded-lg text-sm flex-grow">
                <button onclick="addLinkEntry()" class="py-2 px-4 slate-btn font-semibold rounded-lg text-sm whitespace-nowrap">Add Link</button>
            </div>

            <p id="link-modal-error" class="text-sm text-red-400 mb-2"></p>

            <div class="max-h-60 overflow-y-auto card rounded-lg p-2">
                <table id="link-entry-table" class="modal-table w-full text-left text-sm">
                    <thead>
                        <tr class="text-[#88BBF2]">
                            <th class="p-2 w-1/4">Name</th>
                            <th class="p-2 w-3/4">Link</th>
                            <th class="p-2 w-16"></th>
                        </tr>
                    </thead>
                    <tbody id="link-entry-list">
                        </tbody>
                </table>
                 <p id="no-link-entries" class="text-center text-[#6A89A7] py-4">No link entries added yet.</p>
            </div>

            <div class="flex justify-end mt-4">
                <button onclick="closeLinkModal()" class="py-2 px-4 clear-chat-btn font-semibold rounded-lg">Done</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>